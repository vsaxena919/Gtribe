(function(){'use strict';let uvsTimerID=0;var uvsMicListenAutoTimeoutDuration=null;if(typeof(uvsMicListenTimeoutDuration)!='undefined'&&uvsMicListenTimeoutDuration!==null){uvsMicListenAutoTimeoutDuration=parseInt(uvsMicListenTimeoutDuration);uvsMicListenAutoTimeoutDuration=isNaN(uvsMicListenAutoTimeoutDuration)?8:uvsMicListenAutoTimeoutDuration}else{uvsMicListenAutoTimeoutDuration=8}
uvsMicListenAutoTimeoutDuration=(uvsMicListenAutoTimeoutDuration<8)?8:uvsMicListenAutoTimeoutDuration;uvsMicListenAutoTimeoutDuration=(uvsMicListenAutoTimeoutDuration>20)?20:uvsMicListenAutoTimeoutDuration;uvsMicListenAutoTimeoutDuration=uvsMicListenAutoTimeoutDuration*1000;function uvsClearTimer(timerInstance){try{if(typeof(timerInstance)!='undefined'&&timerInstance!==null&&timerInstance!=!1){clearInterval(timerInstance)}}catch(err){}}
function getNumber(number){number=parseInt(number,10);return isNaN(number)||number===null||typeof(number)==='undefined'?0:number}
function uvsAnyOtherMicListening(uvsExceptionBtnId=null){var uvsOneOfMicListening=!1;try{var uvsAllMicButtons=document.querySelectorAll('button.universal-voice-search-button');if(typeof(uvsAllMicButtons)=='undefined'||uvsAllMicButtons===null||uvsExceptionBtnId==null){return uvsOneOfMicListening}
for(var uvsI=0;uvsI<uvsAllMicButtons.length;uvsI++){var uvsClassNames=uvsAllMicButtons[uvsI].className;var uvsBtnId=uvsAllMicButtons[uvsI].getAttribute('id');if(!(typeof(uvsClassNames)!='undefined'&&uvsClassNames.trim()!=''))continue;if(uvsClassNames.indexOf('listening')!=-1&&uvsExceptionBtnId!=uvsBtnId){uvsOneOfMicListening=!0;break}}}catch(err){uvsOneOfMicListening=!1}
return uvsOneOfMicListening}
var inputWrapperSelectorsToSeek=['form[role=search]','form[class=searchform]','form[class=search_form]','form[class=search-form]','form[class=searchForm]'];var searchInputSelectorsToSeek=['input[name=s]','input[name=search]','input[name=find]','input[type=search]','input[class=search-field]','input[class=search_field]','input[class=searchfield]','input[class=searchField]','input[id=search]','input[id=search-field]','input[id=search_field]','input[id=searchfield]','input[id=searchField]'];var uvsIOS=!!navigator.platform&&/iPad|iPhone|iPod/.test(navigator.platform);var uvsMicEventToListen=(uvsIOS===!0)?'touchend':'click';var ua=navigator.userAgent.toLowerCase();var isAndroid=ua.indexOf("android")>-1;var recordTimer=null;var uvsAllFormsOnPage=document.querySelectorAll('form');var speechInputWrappers=[];try{for(var vdnI=0;vdnI<inputWrapperSelectorsToSeek.length;vdnI++){speechInputWrappers=document.querySelectorAll(inputWrapperSelectorsToSeek[vdnI]);if(speechInputWrappers.length>0){break}}}catch(err){speechInputWrappers=[]}
if(speechInputWrappers.length<uvsAllFormsOnPage.length){speechInputWrappers=null;speechInputWrappers=uvsAllFormsOnPage}
let formElementForWidget=null;[].forEach.call(speechInputWrappers,function(speechInputWrapper,index){var inputEl=null;var recognizing=!1;try{if(index==0){formElementForWidget=speechInputWrapper}
for(var uvsI=0;uvsI<searchInputSelectorsToSeek.length;uvsI++){inputEl=speechInputWrapper.querySelector(searchInputSelectorsToSeek[uvsI]);if(inputEl!==null){break}}
let formSubmitBtnEl=speechInputWrapper.querySelector("input[type=submit]");if(formSubmitBtnEl===null){formSubmitBtnEl=speechInputWrapper.querySelector("button[type=submit]")}
if(formSubmitBtnEl!==null){speechInputWrapper.addEventListener('submit',function(submitEvent){if(recognizing==!0){submitEvent.preventDefault()}},!1);try{let submitButtonChildNodes=formSubmitBtnEl.querySelectorAll('img, svg');for(let j=0;j<submitButtonChildNodes.length;j++){let submitBtnChildNode=submitButtonChildNodes[j];submitBtnChildNode.classList.add('uvs-hide-element')}}catch(err){}}}catch(err){inputEl=null}
if(null===inputEl){return}
try{var speechInputWrapperStyle=speechInputWrapper.getAttribute('style');var havingInlineStyle=(typeof(speechInputWrapperStyle)!='undefined'&&speechInputWrapperStyle!==null&&speechInputWrapperStyle.trim()!='')?!0:!1;speechInputWrapperStyle=(havingInlineStyle)?speechInputWrapperStyle+';':'';speechInputWrapper.setAttribute('style',speechInputWrapperStyle+'display: block !important');speechInputWrapper.classList.add('universal-voice-search-wrapper');speechInputWrapper.classList.add('uvs-sanitize-form-wrapper');var micBtn=document.createElement('button');micBtn.setAttribute('type','button');micBtn.setAttribute('class','universal-voice-search-button');micBtn.setAttribute('id','universal-voice-search-button'+index);micBtn.appendChild(document.createTextNode(universal_voice_search.button_message));var uvsMicIcon=document.createElement('img');uvsMicIcon.setAttribute('src',uvsImagesPath+'uvs_mic.svg');uvsMicIcon.setAttribute('class','uvs-mic-image');micBtn.appendChild(uvsMicIcon);var inputHeight=getNumber(inputEl.offsetHeight);var buttonSize=getNumber(0.8*inputHeight);if(getNumber(buttonSize)==0){inputHeight=buttonSize=35}
var micbtnPositionTop=getNumber(0.1*inputHeight);var inlineStyle='top: '+micbtnPositionTop+'px; ';inlineStyle+='height: '+buttonSize+'px !important; ';inlineStyle+='width: '+buttonSize+'px !important; ';inlineStyle+='z-index: 999 !important; margin-left: 3px !important; border-radius: 50% !important;  border: 2px solid #ffff !important;';micBtn.setAttribute('style',inlineStyle);var wrapper=document.createElement('div');let inputCurrentStyle=window.getComputedStyle(inputEl);wrapper.setAttribute('class','uvs-mic-band');wrapper.setAttribute('onclick','return false');wrapper.style.width=inputCurrentStyle.width;inputEl.insertAdjacentElement('beforebegin',wrapper);var parentEl=inputEl.parentNode.nodeName;if(typeof(parentEl)!='undefined'&&parentEl!==null&&parentEl.length!=0){parentEl=parentEl.toLowerCase();if(parentEl!='form'){inputEl.parentNode.style.zIndex=1}}
wrapper.appendChild(inputEl);inputEl.insertAdjacentElement('beforebegin',micBtn);inputEl.classList.add('uvs-mic-band');speechInputWrapper.setAttribute('style',speechInputWrapperStyle);var finalTranscript='';var final_transcript="";var ignore_onend;if('webkitSpeechRecognition' in window){var recognition=new webkitSpeechRecognition();recognition.continuous=!0;recognition.interimResults=!0;recognition.onstart=function(){recognizing=!0};recognition.onerror=function(event){uvsClearTimer(recordTimer);micBtn.classList.remove('listening');recognizing=!1;if(event.error=='no-speech'){inputEl.placeholder=uvsAlternativeResponse.notAudible;tts(uvsAlternativeResponse.notAudible,function(){});ignore_onend=!0}
if(event.error=='audio-capture'){inputEl.placeholder=uvsMessages.micNotAccessible;ignore_onend=!0}
if(event.error=='not-allowed'){inputEl.placeholder=uvsMessages.browserDenyMicAccess;micBtn.style.setProperty("color","white");ignore_onend=!0}};function processEnd(){recognizing=!1;if(ignore_onend){return}
finalTranscript=final_transcript;micBtn.classList.remove('listening');micBtn.style.setProperty("color","white");if(typeof(finalTranscript)!='undefined'&&finalTranscript.length!=0){inputEl.value=final_transcript;tts(uvsAlternativeResponse.basic,function(){speechInputWrapper.submit()})}else{inputEl.placeholder=uvsMessages.ask}};recognition.onend=function(){if(isAndroid){processEnd()}};recognition.onresult=function(event){let interim_transcript='';if(typeof(event.results)=='undefined'){recognition.onend=null;recognition.stop();inputEl.placeholder=uvsMessages.unableToHear;tts(uvsAlternativeResponse.micConnect,function(){});return}
for(var i=event.resultIndex;i<event.results.length;++i){if(event.results[i].isFinal){final_transcript=event.results[i][0].transcript;if(isAndroid==!1){processEnd();recognition.stop()}}else{interim_transcript+=event.results[i][0].transcript;inputEl.value=interim_transcript}}};micBtn.addEventListener(uvsMicEventToListen,function(event){if(uvsAnyOtherMicListening(micBtn.getAttribute('id'))===!0)return;var micButtonInteracted=document.getElementById("universal-voice-search-button"+index);var classNamesInContext=micButtonInteracted.className;if(!(typeof(classNamesInContext)!='undefined'&&classNamesInContext!==null&&classNamesInContext.indexOf('listening')!=-1)){recordTimer=setInterval(function(){var updatedClassNames=micButtonInteracted.className;if(typeof(updatedClassNames)!='undefined'&&updatedClassNames!==null&&updatedClassNames.indexOf('listening')!=-1){micButtonInteracted.click()}
uvsClearTimer(recordTimer);recordTimer=!1},uvsMicListenAutoTimeoutDuration)}
if(recognizing){if(isAndroid==!1){processEnd();recognition.stop()}}else{micBtn.classList.add('listening');event.preventDefault();tts_stop();inputEl.value=finalTranscript='';recognizing=!0;recognition.lang=uvsSelectedLang;recognition.start();ignore_onend=!1}})}else{micBtn.addEventListener(uvsMicEventToListen,function(event){if(uvsAnyOtherMicListening(micBtn.getAttribute('id'))===!0)return;if(!uvsAudioRecorder||!uvsAudioContext){uvsInitAudio(function(a){if(!uvsAudioRecorder||!uvsAudioContext){alert(uvsMessages.cantAccessMicrophone);return!1}else{listenEvent()}})}else{listenEvent()}
function listenEvent(){if(!(typeof(uvsXApiKey)!='undefined'&&uvsXApiKey!==null)){tts(uvsAlternativeResponse.unavailable,function(){});return!1}
var micButtonInteracted=document.getElementById("universal-voice-search-button"+index);var classNamesInContext=micButtonInteracted.className;if(!(typeof(classNamesInContext)!='undefined'&&classNamesInContext!==null&&classNamesInContext.indexOf('listening')!=-1)){recordTimer=setInterval(function(){var updatedClassNames=micButtonInteracted.className;if(typeof(updatedClassNames)!='undefined'&&updatedClassNames!==null&&updatedClassNames.indexOf('listening')!=-1){micButtonInteracted.click()}
uvsClearTimer(recordTimer);recordTimer=!1},uvsMicListenAutoTimeoutDuration)}
if(recognizing){uvsClearTimer(recordTimer);uvsAudioRecorder.stop();uvsStopAudio();micBtn.classList.remove('listening');micBtn.style.setProperty("color","white");inputEl.placeholder=uvsMessages.transcribeText;tts("",function(){uvsAudioRecorder.getBuffers(function(buffers){uvsAudioRecorder.exportWAV(function(blob){uvsRecIndex++;stt(blob,!1,function(request){if(typeof(request)!='undefined'&&request.length!=0){inputEl.value=request;tts(uvsAlternativeResponse.basic,function(){speechInputWrapper.submit()})}else{tts(uvsAlternativeResponse.notAudible,function(){});inputEl.placeholder=uvsMessages.ask}})})})});recognizing=!1;return}else{micBtn.classList.add('listening');event.preventDefault();tts_stop();inputEl.value=finalTranscript='';recognizing=!0;uvsAudioRecorder.clear();uvsAudioRecorder.record(micButtonInteracted)}}},!1)}}catch(err){}});if(uvsFloatingMic&&uvsFloatingMic==='yes'){let uvsDocFragment=document.createDocumentFragment();let uvsWidgetWrapper=document.createElement('div');let uvsWrapperMicPositionClass='uvs-widget-wrapper-middle-right';let uvsChatWrapperMicPositionClass='uvs-widget-chat-wrapper-middle-right';let uvsMicPosition=uvsSelectedMicPosition?uvsSelectedMicPosition.toLowerCase():'middle right';switch(uvsMicPosition){case 'middle left':uvsWrapperMicPositionClass='uvs-widget-wrapper-middle-left';uvsChatWrapperMicPositionClass='uvs-widget-chat-wrapper-middle-left';break;case 'top right':uvsWrapperMicPositionClass='uvs-widget-wrapper-top-right';uvsChatWrapperMicPositionClass='uvs-widget-chat-wrapper-top-right';break;case 'top left':uvsWrapperMicPositionClass='uvs-widget-wrapper-top-left';uvsChatWrapperMicPositionClass='uvs-widget-chat-wrapper-top-left';break;case 'bottom right':uvsWrapperMicPositionClass='uvs-widget-wrapper-bottom-right';uvsChatWrapperMicPositionClass='uvs-widget-chat-wrapper-bottom-right';break;case 'bottom left':uvsWrapperMicPositionClass='uvs-widget-wrapper-bottom-left';uvsChatWrapperMicPositionClass='uvs-widget-chat-wrapper-bottom-left';break;default:uvsWrapperMicPositionClass='uvs-widget-wrapper-middle-right';uvsChatWrapperMicPositionClass='uvs-widget-chat-wrapper-middle-right'}
uvsWidgetWrapper.setAttribute('class','uvs-widget-wrapper '+uvsWrapperMicPositionClass+'');let uvsWidgetChatWrapper=document.createElement('div');uvsWidgetChatWrapper.setAttribute('class','uvs-widget-chat-wrapper '+uvsChatWrapperMicPositionClass+'');let uvsWidgetField=document.createElement('div');uvsWidgetField.setAttribute('class','uvs-widget-field');let uvsWidgetMic=document.createElement('a');uvsWidgetMic.setAttribute('id','uvsWidgetMic');uvsWidgetMic.setAttribute('class','uvs-widget-button');let uvsWidgetMicImg=document.createElement('img');uvsWidgetMicImg.setAttribute('src',uvsImagesPath+'uvs-widget-mic-black.svg');uvsWidgetMic.appendChild(uvsWidgetMicImg);let uvsWidgetSearchBtn=document.createElement('a');uvsWidgetSearchBtn.setAttribute('id','uvsWidgetSearchBtn');let uvsWidgetSearchBtnEl=document.createElement('button');uvsWidgetSearchBtnEl.setAttribute('class','uvs-widget-form-submit-btn');uvsWidgetSearchBtnEl.setAttribute('type','submit');uvsWidgetSearchBtnEl.setAttribute('alt','Go');uvsWidgetSearchBtnEl.setAttribute('title','Search');uvsWidgetSearchBtn.appendChild(uvsWidgetSearchBtnEl);let uvsWidgetForm=document.createElement('form');uvsWidgetForm.setAttribute("class","uvs-widget-form");if(formElementForWidget!==null){uvsWidgetForm.action=formElementForWidget.action;uvsWidgetForm.method=formElementForWidget.method}else{uvsWidgetForm.action=uvsGetCurrentHostURL()+'/';uvsWidgetForm.method="get"}
let uvsWidgetSearch=document.createElement('input');uvsWidgetSearch.setAttribute('id','uvsWidgetSearch');uvsWidgetSearch.setAttribute('class','uvs-widget-search uvs-widget-search-text');uvsWidgetSearch.setAttribute('name','uvs-widget-search');uvsWidgetSearch.setAttribute('placeholder',uvsWidgetMessages.placeholder);uvsWidgetSearch.setAttribute('name','s');uvsWidgetForm.appendChild(uvsWidgetSearch);uvsWidgetForm.appendChild(uvsWidgetSearchBtn);uvsWidgetField.appendChild(uvsWidgetMic);uvsWidgetField.appendChild(uvsWidgetForm);uvsWidgetChatWrapper.appendChild(uvsWidgetField);let uvsWidgetToggleButton=document.createElement('a');uvsWidgetToggleButton.setAttribute('id','uvsWidgetToggleButton');uvsWidgetToggleButton.setAttribute('class','uvs-widget-button');let uvsWidgetIcon=document.createElement('div');uvsWidgetIcon.setAttribute('class','uvs-widget-icon uvs-widget-toggle-button uvs-toggle-btn-mic');uvsWidgetToggleButton.appendChild(uvsWidgetIcon);uvsWidgetWrapper.appendChild(uvsWidgetChatWrapper);uvsWidgetWrapper.appendChild(uvsWidgetToggleButton);uvsDocFragment.appendChild(uvsWidgetWrapper);document.body.appendChild(uvsDocFragment);uvsWidgetToggleButton.addEventListener('click',function(event){uvsToggleWidgetElements()});let widgetFinalTranscript='';let widgetRecognizing=!1;let widget_final_transcript="";let widget_ignore_onend;if('webkitSpeechRecognition' in window){let widgetRecognition=new webkitSpeechRecognition();widgetRecognition.continuous=!0;widgetRecognition.interimResults=!0;widgetRecognition.onstart=function(){widgetRecognizing=!0};widgetRecognition.onerror=function(event){uvsWidgetMic.classList.remove('listening');widgetRecognizing=!1;if(event.error=='no-speech'){tts(uvsAlternativeResponse.notAudible,function(){});widget_ignore_onend=!0;uvsWidgetSearch.placeholder=uvsAlternativeResponse.notAudible}
if(event.error=='audio-capture'){widget_ignore_onend=!0;uvsWidgetSearch.placeholder=uvsMessages.micNotAccessible}
if(event.error=='not-allowed'){widget_ignore_onend=!0;uvsWidgetSearch.placeholder=uvsMessages.browserDenyMicAccess}};function widgetProcessEnd(){widgetRecognizing=!1;if(widget_ignore_onend){return}
widgetFinalTranscript=widget_final_transcript;uvsWidgetMic.classList.remove('listening');if(typeof(widgetFinalTranscript)!='undefined'&&widgetFinalTranscript.length!=0){uvsWidgetSearch.value=widgetFinalTranscript;tts(uvsAlternativeResponse.basic,function(){uvsWidgetForm.submit()})}else{tts(uvsAlternativeResponse.notAudible,function(){});uvsWidgetSearch.placeholder=uvsMessages.ask}}
widgetRecognition.onend=function(){if(isAndroid){widgetProcessEnd()}};widgetRecognition.onresult=function(event){let interim_transcript='';if(typeof(event.results)=='undefined'){widgetRecognition.onend=null;widgetRecognition.stop();uvsWidgetSearch.placeholder=uvsMessages.unableToHear;tts(uvsAlternativeResponse.micConnect,function(){});return}
let eventResultsLength=event.results.length;for(let i=event.resultIndex;i<eventResultsLength;++i){if(event.results[i].isFinal){widget_final_transcript=event.results[i][0].transcript;if(isAndroid==!1){widgetProcessEnd();widgetRecognition.stop()}}else{interim_transcript+=event.results[i][0].transcript}}};uvsWidgetMic.addEventListener(uvsMicEventToListen,function(event){if(uvsAnyOtherMicListening(uvsWidgetMic.getAttribute('id'),uvsWidgetMic)===!0)return;let classNamesInContext=uvsWidgetMic.className;function uvsSetTimeOut(uvsMyTimerid,uvsMicBtn,uvsTimeOutTime){return new Promise(function(resolve){setTimeout(function(){var updatedClassNames=uvsMicBtn.className;if(typeof(updatedClassNames)!='undefined'&&updatedClassNames!==null&&updatedClassNames.indexOf('listening')!=-1&&uvsMyTimerid==uvsTimerID){uvsMicBtn.click()}
resolve('resolved')},uvsTimeOutTime)})}
if(!(typeof(classNamesInContext)!='undefined'&&classNamesInContext!==null&&classNamesInContext.indexOf('listening')!=-1)){uvsTimerID=uvsTimerID+1;uvsSetTimeOut(uvsTimerID,uvsWidgetMic,uvsMicListenAutoTimeoutDuration)}
if(widgetRecognizing){if(isAndroid==!1){widgetProcessEnd();widgetRecognition.stop()}}else{uvsWidgetMic.classList.add('listening');event.preventDefault();tts_stop();widgetFinalTranscript='';widgetRecognizing=!0;widgetRecognition.lang=uvsSelectedLang;widgetRecognition.start();widget_ignore_onend=!1}})}else{uvsWidgetMic.addEventListener(uvsMicEventToListen,function(event){if(uvsAnyOtherMicListening(uvsWidgetMic.getAttribute('id'),uvsWidgetMic)===!0)return;if(!uvsAudioRecorder||!uvsAudioContext){uvsInitAudio(function(a){if(!uvsAudioRecorder||!uvsAudioContext){uvsWidgetSearch.placeholder=uvsMessages.micNotAccessible;return!1}else{widgetListenEvent()}})}else{widgetListenEvent()}
function widgetListenEvent(){if(!(typeof(uvsXApiKey)!='undefined'&&uvsXApiKey!==null)){tts(uvsAlternativeResponse.unavailable,function(){});return!1}
let classNamesInContext=uvsWidgetMic.className;function uvsSetTimeOut(uvsMyTimerid,uvsMicBtn,uvsTimeOutTime){return new Promise(function(resolve){setTimeout(function(){var updatedClassNames=uvsMicBtn.className;if(typeof(updatedClassNames)!='undefined'&&updatedClassNames!==null&&updatedClassNames.indexOf('listening')!=-1&&uvsMyTimerid==uvsTimerID){uvsWidgetMic.click()}
resolve('resolved')},uvsTimeOutTime)})}
if(!(typeof(classNamesInContext)!='undefined'&&classNamesInContext!==null&&classNamesInContext.indexOf('listening')!=-1)){uvsTimerID=uvsTimerID+1;uvsSetTimeOut(uvsTimerID,uvsWidgetMic,uvsMicListenAutoTimeoutDuration)}
if(widgetRecognizing){uvsAudioRecorder.stop();uvsStopAudio();uvsWidgetMic.classList.remove('listening');uvsWidgetSearch.placeholder=uvsMessages.transcribeText;tts("",function(){uvsAudioRecorder.getBuffers(function(buffers){uvsAudioRecorder.exportWAV(function(blob){uvsRecIndex++;stt(blob,!1,function(request){if(typeof(request)!='undefined'&&request.length!=0){uvsWidgetSearch.value=request;tts(uvsAlternativeResponse.basic,function(){uvsWidgetForm.submit()})}else{tts(uvsAlternativeResponse.notAudible,function(){});uvsWidgetSearch.placeholder=uvsMessages.ask}})})})});widgetRecognizing=!1;return}else{uvsWidgetMic.classList.add('listening');event.preventDefault();tts_stop();widgetFinalTranscript='';widgetRecognizing=!0;uvsAudioRecorder.clear();uvsAudioRecorder.record(uvsWidgetMic)}}},!1)}
function uvsToggleClass(elmSelector,nameOfClass){if(!(typeof(elmSelector)!='undefined'&&elmSelector!=null&&elmSelector.length!=0))return!1;let element=document.querySelector(elmSelector);if(element.classList){element.classList.toggle(nameOfClass)}else{let classes=element.className.split(" ");let i=classes.indexOf(nameOfClass);if(i>=0){classes.splice(i,1)}else{classes.push(nameOfClass);element.className=classes.join(" ")}}}
function uvsToggleWidgetElements(){uvsToggleClass('.uvs-widget-toggle-button','uvs-toggle-btn-mic');uvsToggleClass('.uvs-widget-toggle-button','uvs-toggle-btn-close');uvsToggleClass('.uvs-widget-toggle-button','uvs-widget-active');uvsToggleClass('.uvs-widget-toggle-button','uvs-widget-visible');uvsToggleClass('#uvsWidgetToggleButton','uvs-widget-float');uvsToggleClass('.uvs-widget-chat-wrapper','uvs-widget-visible');uvsToggleClass('.uvs-widget-button','uvs-widget-visible')}}})()