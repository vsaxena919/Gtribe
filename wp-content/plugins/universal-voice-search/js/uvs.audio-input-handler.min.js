window.AudioContext=window.AudioContext||window.webkitAudioContext;var uvsAudioContext=null;var uvsAudioInput=null,uvsRealAudioInput=null,uvsInputPoint=null,uvsAudioRecorder=null;var uvsRecIndex=0;var uvsToken="";var initCB=null;let uvsStream=null;function uvsGetToken(){if(!(typeof(uvsXApiKey)!='undefined'&&uvsXApiKey!==null))return;try{let uvsLastUpdatedAtTimestamp=uvsServiceLogs.updatedAt||null;if(uvsLastUpdatedAtTimestamp!==null){uvsLastUpdatedAtTimestamp=Number(uvsLastUpdatedAtTimestamp);let currentUtcTimestamp=Math.round(new Date().getTime()/1000);uvsLastUpdatedAtTimestamp=uvsLastUpdatedAtTimestamp+(24*3600);if(currentUtcTimestamp>=uvsLastUpdatedAtTimestamp){uvsLogServiceCall(1)}}}catch(err){}
var locallyPreservedToken=uvsGetLocallyPreservedToken();if(typeof(locallyPreservedToken)!='undefined'&&locallyPreservedToken!==null&&locallyPreservedToken.length!=0){uvsToken=locallyPreservedToken;return}
var xhttp=new XMLHttpRequest();xhttp.onreadystatechange=function(){if(this.readyState==4&&this.status==200){var res=JSON.parse(this.responseText);uvsToken=res.token;uvsPreserveToken(uvsToken)}};try{xhttp.open("GET",uvsTokenApiUrl,!0);xhttp.setRequestHeader("Content-type","application/json");xhttp.setRequestHeader("x-api-key",uvsXApiKey);xhttp.send()}catch(err){console.log('We had an error while availing token. Error:'+err.message)}}
function uvsGotStream(stream){uvsInputPoint=uvsAudioContext.createGain();uvsStream=stream;uvsRealAudioInput=uvsAudioContext.createMediaStreamSource(stream);uvsAudioInput=uvsRealAudioInput;uvsAudioInput.connect(uvsInputPoint);uvsAudioRecorder=new Recorder(uvsInputPoint);initCB(uvsAudioRecorder)}
function uvsInitAudio(cb){uvsGetToken();initCB=cb;uvsAudioContext=new AudioContext();navigator.mediaDevices.getUserMedia({"audio":!0}).then(uvsGotStream).catch(function(e){console.log("We caught en error while gaining access to audio input",e.message)})}
function uvsStopAudio(){try{uvsStream.getTracks().forEach(function(track){track.stop()});uvsAudioContext.close();uvsAudioContext=null}catch(err){console.log('UVS Exception: Unable to release audio resource due to: '+err.message)}}