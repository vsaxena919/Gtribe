!function(t){t.fn.getType=function(){return"INPUT"==this[0].tagName?this[0].type.toLowerCase():this[0].tagName.toLowerCase()};var e='<div class="rtcl-spinner block"><span class="rtcl-icon-spinner animate-spin"></span></div>';if(t.fn.validate){var r=t("form#rtcl-post-form");r.length&&r.validate({submitHandler:function(e){try{tinymce.triggerSave(),tinymce.get("description").save()}catch(t){}if(rtcl.recaptcha_listing>0&&0==grecaptcha.getResponse(rtcl.recaptcha_responce.listing).length)return t("#rtcl-listing-g-recaptcha-message").addClass("text-danger").html(rtcl.recaptcha_invalid_message),grecaptcha.reset(rtcl.recaptcha_responce.listing),!1;var c=r.parent(".rtcl-post-form-wrap"),a=t(".rtcl-submit-btn",r),n=t("<div class='alert rtcl-response'></div>");return t.ajax({url:rtcl.ajaxurl,type:"POST",dataType:"json",data:t(e).serialize()+"&action=rtcl_post_new_listing",beforeSend:function(){r.find(".alert.rtcl-response").remove(),c.addClass("rtcl-loading"),a.find(".rtcl-icon-spinner").remove(),a.attr("disabled",!0).append("<span class='rtcl-icon-spinner animate-spin'> </span>")},success:function(t){a.prop("disabled",!1).find(".rtcl-icon-spinner").remove(),c.removeClass("rtcl-loading");var e="";t.success?(r[0].reset(),t.success_message.length&&t.success_message.map(function(t){e+="<p>"+t+"</p>"}),e&&n.removeClass("alert-danger").addClass("alert-success").html(e).appendTo(r),t.redirect_url&&(window.location.href=t.redirect_url)):t.error_message.length&&(t.error_message.map(function(t){e+="<p>"+t+"</p>"}),e&&n.removeClass("alert-success").addClass("alert-danger").html(e).appendTo(r))},error:function(t){console.log(t),n.removeClass("alert-success").addClass("alert-danger").html(t.responseText).appendTo(r),a.prop("disabled",!1).find(".rtcl-icon-spinner").remove(),c.removeClass("rtcl-loading")}}),!1}})}function c(e){var r=t("#rtcl-price-row"),c=t("#rtcl-price-wrap"),a=t("#rtcl-price-unit-wrap",r),n=a.length,s={action:"rtcl_get_price_units_ajax",term_id:e||0};t.ajax({url:rtcl.ajaxurl,data:s,type:"POST",dataType:"json",beforeSend:function(){},success:function(t){t.html?(c.removeClass("col-md-12").addClass("col-md-6"),n&&a.remove(),r.append(t.html)):(c.removeClass("col-md-6").addClass("col-md-12"),a.remove())},error:function(){}})}t(document.body).on("rtcl_price_type_changed",function(e,r){"on_call"==r.value||"free"==r.value||"no_price"==r.value?(t("#rtcl-price").attr("required","false").val(""),t("#rtcl-price-row").hide()):(t("#rtcl-price").attr("required","true"),t("#rtcl-price-row").show())}).on("change","#rtcl-price-type",function(){t(document.body).trigger("rtcl_price_type_changed",[this])}),t(function(){t("#rtcl-price-type").trigger("change"),t.fn.select2&&t(".rtcl-select2").length,t("#rtcl-ad-type").on("change",function(){var r=t(this),c=r.val(),a=t("#rtcl-price-row");if(a.find(".price-label .rtcl-per-unit").remove(),"to_let"==c){var n=a.find("label").attr("data-per-unit");a.find(".price-label").append('<span class="rtcl-per-unit"> / '+n+"</span>")}if("job"==c?t("#rtcl-form-price-wrap").slideUp(250):t("#rtcl-form-price-wrap").slideDown(250),c){var s={action:"rtcl_get_one_level_category_select_list_by_type",type:c};t.ajax({url:rtcl.ajaxurl,data:s,type:"POST",dataType:"json",beforeSend:function(){t(e).insertAfter(r),t("#rtcl-custom-fields-list").html(""),t("#rtcl-sub-category").html(""),t("#sub-cat-row").addClass("rtcl-hide")},success:function(e){console.log(e),r.next(".rtcl-spinner").remove(),e.success?t("#rtcl-category").html(e.cats):t("#rtcl-category").html("")},error:function(t){r.next(".rtcl-spinner").remove(),console.log(t.responseText)}})}else t("#rtcl-custom-fields-list").html(""),t("#rtcl-category").html(""),t("#rtcl-sub-category").html(""),t("#sub-cat-row").addClass("rtcl-hide")}),t("#rtcl-category").on("change",function(){var r=t(this),a=t("#rtcl-custom-fields-list"),n=t(this).val(),s={action:"rtcl_custom_fields_listings",post_id:a.data("post_id"),term_id:n,is_admin:rtcl.is_admin};t.ajax({url:rtcl.ajaxurl,data:s,type:"POST",dataType:"json",beforeSend:function(){a.html(e),t(e).insertAfter(r)},success:function(e){r.next(".rtcl-spinner").remove(),a.html(e.custom_fields),n?(t("#rtcl-sub-category").html(e.child_cats),e.child_cats?t("#sub-cat-row").removeClass("rtcl-hide"):t("#sub-cat-row").addClass("rtcl-hide")):t("#sub-cat-row").addClass("rtcl-hide")},error:function(){a.html(""),r.next(".rtcl-spinner").remove()}}),c(n)}),t("#rtcl-sub-category").on("change",function(){t("#rtcl-custom-fields-list").html(e);var r=t(this),a=t("#rtcl-custom-fields-list"),n=t(this).val()||t("#rtcl-category").val(),s={action:"rtcl_custom_fields_listings",post_id:a.data("post_id"),term_id:n};t.ajax({url:rtcl.ajaxurl,data:s,type:"POST",dataType:"json",beforeSend:function(){a.html(e),t(e).insertAfter(r)},success:function(t){r.next(".rtcl-spinner").remove(),a.html(t.custom_fields)},error:function(){r.next(".rtcl-spinner").remove(),a.html("")}}),c(n)}),t("#rtcl-location").on("change",function(){var r=t(this),c=t("#rtcl-sub-location"),a=c.parents("#sub-location-row"),n={action:"rtcl_get_sub_location_options",term_id:t(this).val()};t.ajax({url:rtcl.ajaxurl,data:n,type:"POST",dataType:"json",beforeSend:function(){t(e).insertAfter(r)},success:function(e){r.next(".rtcl-spinner").remove(),c.find("option").each(function(){t(this).val().trim()&&t(this).remove()}),c.append(e.locations),e.locations?a.removeClass("rtcl-hide"):a.addClass("rtcl-hide")},error:function(){r.next(".rtcl-spinner").remove()}})}),t("#rtcl-sub-location").on("change",function(){var r=t(this),c=t("#rtcl-sub-sub-location"),a=c.parents("#sub-sub-location-row"),n={action:"rtcl_get_sub_location_options",term_id:t(this).val()};t.ajax({url:rtcl.ajaxurl,data:n,type:"POST",dataType:"json",beforeSend:function(){t(e).insertAfter(r)},success:function(e){r.next(".rtcl-spinner").remove(),c.find("option").each(function(){t(this).val().trim()&&t(this).remove()}),c.append(e.locations),e.locations?a.removeClass("rtcl-hide"):a.addClass("rtcl-hide")},error:function(){r.next(".rtcl-spinner").remove()}})})}),t(window).bind("beforeunload",function(){var e=parseInt(t("#_post_id").val(),10);if(e&&0!==e&&!isNaN(e)){var r={action:"rtcl_delete_temp_listing",__rtcl_wpnonce:rtcl.__rtcl_wpnonce,id:e};t.ajax(rtcl.ajaxurl,{data:r,dataType:"json",type:"post",success:function(t){}})}})}(jQuery);
